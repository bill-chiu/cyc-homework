<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Breakout Game</title>
    <script type="text/javascript" src="jquery.js"></script>
    <script>
        $(function () {

            // this is the same as document.getElementById('canvas');
            var canvas = $('#canvas')[0];
            // different browsers support different contexts. All support 2d
            var context = canvas.getContext('2d');

            var paddleX = 200;
            var paddleY = 460;

            var paddleWidth = 100;
            var paddleHeight = 15;

            var paddleDeltaX = 0;
            var paddleDeltaY = 0;

            function drawPaddle() {
                context.fillRect(paddleX, paddleY, paddleWidth, paddleHeight);
            }

            // drawPaddle();


            var ballX = 300;
            var ballY = 300;
            var ballRadius = 10;

            var itemX = 100;
            var itemY = 100;
            var itemRadius = 5;
            //
            function drawBall() {
                // Context.beginPath when you draw primitive shapes
                context.beginPath();

                // Draw arc at center ballX, ballY with radius ballRadius, 
                // From 0 to 2xPI radians (full circle)
                context.arc(ballX, ballY, ballRadius, 0, Math.PI * 2, true);

                // Fill up the path that you just drew
                context.fill();
            }

            // drawBall();

            function drawItem() {
                // Context.beginPath when you draw primitive shapes
                context.beginPath();

                // Draw arc at center ballX, ballY with radius ballRadius, 
                // From 0 to 2xPI radians (full circle)
                context.arc(itemX, itemY, itemRadius, 0, Math.PI * 2, true);

                // Fill up the path that you just drew
                context.fill();
            }

            // drawItem();


            //設立隨機磚塊
            brickrandow = Math.ceil(Math.random() * 4);
            //每一行磚塊的陣列
            var bricksa = [];
            //全部磚塊的陣列
            var bricks = [];

            for (var j = 0; j < 4; j++) {
                for (var i = 0; i < 8; i++) {
                    brickrandow = Math.ceil(Math.random() * 4);
                    //將隨機數加入陣列
                    bricksa.push(brickrandow);
                }
                //每一行的陣列加入總陣列
                bricks.push(bricksa);
                //重設bricksa
                bricksa = [];
                console.log(bricks);
            }



            
            var bricksPerRow = 8;
            var brickHeight = 20;
            var brickWidth = canvas.width / bricksPerRow;

            // Brick Layout: 1 is orange, 2 is green, 3 is gray, 0 means no brick 

            // iterate through the bricks array and draw each brick using drawBrick()
            function createBricks() {
                for (var i = 0; i < bricks.length; i++) {
                    for (var j = 0; j < bricks[i].length; j++) {
                        drawBrick(j, i, bricks[i][j]);
                    }
                }
            }

            // draw a single brick
            function drawBrick(x, y, type) {


                switch (type) {
                    // if brick is still visible; three colors for three types of bricks
                    case 1:
                        context.fillStyle = 'orange';
                        break;
                    case 2:
                        context.fillStyle = 'red';
                        break;
                    case 3:
                        context.fillStyle = 'green';
                        break;
                    case 4:
                        context.fillStyle = '#66ccff';
                        break;
                    default:
                        context.clearRect(x * brickWidth, y * brickHeight, brickWidth,
                            brickHeight);
                        break;

                }
                if (type) {
                    //Draw rectangle with fillStyle color selected earlier
                    context.fillRect(x * brickWidth, y * brickHeight, brickWidth,
                        brickHeight);
                    // Also draw blackish border around the brick
                    context.strokeRect(x * brickWidth + 1, y * brickHeight + 1,
                        brickWidth - 2, brickHeight - 2);
                }
            }

            // createBricks();
            //計分表
            var score = 0;

            function displayScoreBoard() {
                //Set the text font and color
                context.fillStyle = 'rgb(50,100,50)';
                context.font = "20px Times New Roman";

                //Clear the bottom 30 pixels of the canvas
                context.clearRect(0, canvas.height - 30, canvas.width, 30);
                // Write Text 5 pixels from the bottom of the canvas
                context.fillText('Score: ' + score, 10, canvas.height - 5);
            }

            // displayScoreBoard();
            //動畫事件
            function animate() {
                context.clearRect(0,0,canvas.width,canvas.height);
                drawPaddle();
                drawBall();
                moveBall();
            }

            var gameLoop;
            function startGame() {
            ballDeltaY = -4;
            ballDeltaX = -2;
            gameLoop = setInterval(animate, 20);
        }

            function endGame() {
                clearInterval(gameLoop);
                context.fillText('The End!!!!', canvas.width / 2, canvas.height / 2);
            }

            startGame();

            var ballDeltaX;
            var ballDeltaY;

            function moveBall(){         

                    //初始高度＋位移－大小超過頂部
                    if (ballY + ballDeltaY - ballRadius < 0){
                        //位移交換
                        ballDeltaY = -ballDeltaY;
                    }

                    //超過底部
                    if (ballY + ballDeltaY + ballRadius > canvas.height){
                        endGame();
                    }
                    //如果碰到左半或是右半
                    if ((ballX + ballDeltaX - ballRadius < 0) ||(ballX + ballDeltaX + ballRadius > canvas.width)){  
                        //左右位移交換
                        ballDeltaX = -ballDeltaX;
                    }

                    //球位置等於原位置加位移
                    ballX = ballX + ballDeltaX;
                    ballY = ballY + ballDeltaY;
                }

        });




    </script>

    <style type="text/css">
        canvas {
            border: 1px solid black;
        }
    </style>

</head>

<body>

    <h1>Breakout</h1>
    <canvas id="canvas" width="400" height="500">
    </canvas>

</body>

</html>